/*=====================================================================
  METADATA COLUMN MAPPING — Bronze → Silver
  ---------------------------------------------------------------
  • Column order matches exactly the Bronze table definition
  • Each mapping classified as: renamed / derived / removed / unchanged
  • "remarks" explain transformation, derivation, or removal reason
=====================================================================*/

IF OBJECT_ID('metadata.column_mapping_bronze_to_silver','U') IS NOT NULL
    DROP TABLE metadata.column_mapping_bronze_to_silver;
GO

CREATE TABLE metadata.column_mapping_bronze_to_silver (
    map_id INT IDENTITY(1,1) PRIMARY KEY,
    source_schema VARCHAR(50),
    source_table VARCHAR(100),
    source_column VARCHAR(200),
    target_schema VARCHAR(50),
    target_table VARCHAR(100),
    target_column VARCHAR(200),
    change_type VARCHAR(50),
    remarks NVARCHAR(500)
);
GO

INSERT INTO metadata.column_mapping_bronze_to_silver
(source_schema, source_table, source_column, target_schema, target_table, target_column, change_type, remarks)
VALUES
('bronze','dataco_supply_chain','Type','silver','dataco_supply_chain','payment_type','renamed','Standardized payment type text (Cash, Debit, etc.)'),
('bronze','dataco_supply_chain','Days for shipping (real)','silver','dataco_supply_chain','actual_shipping_days','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Days for shipment (scheduled)','silver','dataco_supply_chain','scheduled_delivery_days','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Benefit per order','silver','dataco_supply_chain','earning_per_order_item','renamed','Renamed to earning_per_order'),
('bronze','dataco_supply_chain','Sales per customer','silver','dataco_supply_chain','total_sale_per_customer','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Delivery Status','silver','dataco_supply_chain','order_delivery_status','renamed','Renamed and standardized'),
('bronze','dataco_supply_chain','Late_delivery_risk','silver','dataco_supply_chain','order_late_delivery_risk','renamed','Renamed for consistency'),
('bronze','dataco_supply_chain','Category Id','silver','dataco_supply_chain','product_category_id','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Category Name','silver','dataco_supply_chain','product_category_name','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Customer City','silver','dataco_supply_chain','customer_city','renamed','Same meaning, standardized name'),
('bronze','dataco_supply_chain','Customer Country','silver','dataco_supply_chain','customer_country','renamed','Country name normalized (e.g., US → United States)'),
('bronze','dataco_supply_chain','Customer Email','silver','dataco_supply_chain',NULL,'removed','PII removed for compliance'),
('bronze','dataco_supply_chain','Customer Fname','silver','dataco_supply_chain','customer_full_name','derived','Merged with Lname into full name'),
('bronze','dataco_supply_chain','Customer Id','silver','dataco_supply_chain','customer_id','unchanged','Primary key retained'),
('bronze','dataco_supply_chain','Customer Lname','silver','dataco_supply_chain','customer_full_name','derived','Merged with Fname into full name'),
('bronze','dataco_supply_chain','Customer Password','silver','dataco_supply_chain',NULL,'removed','PII removed for compliance'),
('bronze','dataco_supply_chain','Customer Segment','silver','dataco_supply_chain','types_of_customers','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Customer State','silver','dataco_supply_chain','customer_state','renamed','State name standardized'),
('bronze','dataco_supply_chain','Customer Street','silver','dataco_supply_chain','customer_full_street','renamed','Full address retained'),
('bronze','dataco_supply_chain','Customer Zipcode','silver','dataco_supply_chain','customer_zipcode','unchanged','Same meaning'),
('bronze','dataco_supply_chain','Department Id','silver','dataco_supply_chain','store_department_id','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Department Name','silver','dataco_supply_chain','store_department_name','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Latitude','silver','dataco_supply_chain','store_location_latitude','renamed','Renamed and standardized'),
('bronze','dataco_supply_chain','Longitude','silver','dataco_supply_chain','store_location_longitude','renamed','Renamed and standardized'),
('bronze','dataco_supply_chain','Market','silver','dataco_supply_chain','order_continent','renamed','Recoded market regions (LATAM → Latin America)'),
('bronze','dataco_supply_chain','Order City','silver','dataco_supply_chain','order_city','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Order Country','silver','dataco_supply_chain','order_country','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Order Customer Id','silver','dataco_supply_chain','order_customer_id','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','order date (DateOrders)','silver','dataco_supply_chain','order_date','derived','Extracted date only'),
('bronze','dataco_supply_chain','Order Id','silver','dataco_supply_chain','order_id','unchanged','Same identifier'),
('bronze','dataco_supply_chain','Order Item Cardprod Id','silver','dataco_supply_chain','order_item_product_barcode_id','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Order Item Discount','silver','dataco_supply_chain','order_item_discount','renamed','Rounded and standardized'),
('bronze','dataco_supply_chain','Order Item Discount Rate','silver','dataco_supply_chain','order_item_discount_percentage','renamed','Rounded and standardized'),
('bronze','dataco_supply_chain','Order Item Id','silver','dataco_supply_chain','order_item_id','unchanged','Same identifier'),
('bronze','dataco_supply_chain','Order Item Product Price','silver','dataco_supply_chain',NULL,'removed','Duplicate of Product Price'),
('bronze','dataco_supply_chain','Order Item Profit Ratio','silver','dataco_supply_chain','order_item_profit_ratio','unchanged','Same meaning'),
('bronze','dataco_supply_chain','Order Item Quantity','silver','dataco_supply_chain','order_item_quantity','unchanged','Same meaning'),
('bronze','dataco_supply_chain','Sales','silver','dataco_supply_chain','order_item_gross_total','renamed','Renamed and rounded'),
('bronze','dataco_supply_chain','Order Item Total','silver','dataco_supply_chain','order_item_net_total','renamed','Renamed and rounded'),
('bronze','dataco_supply_chain','Order Profit Per Order','silver','dataco_supply_chain','order_profit_per_order_item','renamed','Renamed and rounded'),
('bronze','dataco_supply_chain','Order Region','silver','dataco_supply_chain','order_subregion','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Order State','silver','dataco_supply_chain','order_state','renamed','Same meaning'),
('bronze','dataco_supply_chain','Order Status','silver','dataco_supply_chain','order_status','renamed','Formatted to Title Case'),
('bronze','dataco_supply_chain','Order Zipcode','silver','dataco_supply_chain','order_zipcode','renamed','Same meaning'),
('bronze','dataco_supply_chain','Product Card Id','silver','dataco_supply_chain','product_barcode_id','renamed','Renamed for consistency'),
('bronze','dataco_supply_chain','Product Category Id','silver','dataco_supply_chain',NULL,'removed','Duplicate of Category Id'),
('bronze','dataco_supply_chain','Product Description','silver','dataco_supply_chain',NULL,'removed','Non-analytic text'),
('bronze','dataco_supply_chain','Product Image','silver','dataco_supply_chain',NULL,'removed','Unstructured / not required'),
('bronze','dataco_supply_chain','Product Name','silver','dataco_supply_chain','product_name','unchanged','Same meaning'),
('bronze','dataco_supply_chain','Product Price','silver','dataco_supply_chain','product_unit_price','renamed','Renamed for clarity'),
('bronze','dataco_supply_chain','Product Status','silver','dataco_supply_chain',NULL,'removed','Non-analytic'),
('bronze','dataco_supply_chain','shipping date (DateOrders)','silver','dataco_supply_chain','shipping_date','derived','Extracted date only'),
('bronze','dataco_supply_chain','Shipping Mode','silver','dataco_supply_chain','shipping_mode','unchanged','Same meaning');
GO

-- Add derived fields that didn’t exist in Bronze
INSERT INTO metadata.column_mapping_bronze_to_silver
(source_schema, source_table, source_column, target_schema, target_table, target_column, change_type, remarks)
VALUES
(NULL,NULL,NULL,'silver','dataco_supply_chain','order_time','new derived','Extracted time portion from order date'),
(NULL,NULL,NULL,'silver','dataco_supply_chain','shipping_time','new derived','Extracted time portion from shipping date'),
(NULL,NULL,NULL,'silver','dataco_supply_chain','customer_street_number','new derived','Parsed from Customer Street'),
(NULL,NULL,NULL,'silver','dataco_supply_chain','customer_street_name','new derived','Parsed from Customer Street'),
(NULL,NULL,NULL,'silver','dataco_supply_chain','ingestion_timestamp','new system column','Added for ETL tracking');
GO
